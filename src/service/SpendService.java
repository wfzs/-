package service;

import java.util.List;

import dao.RecordDAO;
import entity.Record;
import gui.page.SpendPage;
import gui.panel.RecoverPanel;
import util.DateUtil;

public class SpendService {
	
	public SpendPage getSpendPage(){
		RecordDAO recordDAO=new RecordDAO();
		//本月数据
		List<Record> thisMonthRecord=recordDAO.listThisMonth();
		//今日数据
		List<Record> todayRecord=recordDAO.listToday();
		//本月总天数
		int thisMonth=DateUtil.thisMonthTotalDay();
		
		int monthSpend=0;
		int todaySpend=0;
		int avgSpendPerDay=0;
		int monthAvailable=0;
		int dayAvgAvailable=0;		
		int monthLeftDay=0; 
		int usagePercentage=0;
		
		//预算
		int monthBudget=new ConfigService().getIntBudget();
		//统计本月消费
		for(Record r:thisMonthRecord){
			monthSpend+=r.getSpend();
		}
		//统计今日消费
		for(Record r:todayRecord){
			todaySpend+=r.getSpend();
		}
		//计算日均消费
		avgSpendPerDay=monthSpend/thisMonth;
		//计算本月剩余
		monthAvailable=monthBudget-monthSpend;
		//距离月末
		monthLeftDay=DateUtil.thisMonthLeftDay();
		//计算日均可用
		dayAvgAvailable=monthAvailable/monthLeftDay;
		//计算使用比率
		usagePercentage=monthSpend*100/monthBudget;
		
		return new SpendPage(monthSpend,todaySpend, avgSpendPerDay, monthAvailable, dayAvgAvailable,
				monthLeftDay, usagePercentage);
	}
}
